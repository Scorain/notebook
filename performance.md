# 前端性能优化

> &copy; suny 2017-02-20 14:16


### 前端性能关注点

+ 速度 `秒开`
+ 体验 `流畅`

### 关于速度

页面的打开速度由资源的加载、解析、渲染三个阶段决定

1）加载

`体积` `策略` `速度`

> 体积： 去除代码中没用的部分、尽量引用小的或者是不引用无用的模块、压缩

> 策略： 缓存、协议

> 速度： 采用CDN存放静态资源、gzip

    缓存是提高网页打开速度的最有效方法之一。
    在浏览器中，页面资源的缓存状态是由http报文的header决定的，缓存的内容为服务端响应的报文，包括响应头和响应体。
    通常，浏览器提供三种不同的缓存策略：
    1. 强缓存 在缓存的过期时间内不发送请求 cache-control expires
    2. 协商缓存 发送请求询问服务器是否更新资源，若未更新，则只返回响应头 last-midified etag
    3. 无缓存 不再客户端缓存任何资源
    除了浏览器自带的缓存机制外，还可以利用localStorage实现用户自定义的缓存，更加自由的控制缓存策略。

-
 
    CDN本质上也是一种缓存，只不过是将资源缓存到了距离用户最近的服务端。
    利用CDN部署静态资源有如下优势：
    1. 用户就近获取
    2. cookie-free
    3. 突破浏览器的并发限制

-

    web通讯采用的是http协议，协议优化是前端性能优化的着手点之一。
    协议优化一般包括如下方面：
    1. 减少请求数
    2. http通过keep-alive进行连接的复用
    3. chunked编码
    4. http/2
    5. https

    

2）解析

> 布局优先： 结构与样式先、行为后

> 首屏优先： 懒加载、预加载

    DOM结构层级越多，性能越差
    css选择器从右向左解析，层级不宜超过三层
    不同的文件格式的解析速度是有区别的
    图片的缩放是很耗性能的
    大图片的每一次引用都是很耗性能的

3）渲染

    页面渲染的时候，最影响性能的样式属性类别包括 圆角 和 阴影


### 关于体验

体验是页面打开之后的事情，页面操作的流畅性往往决定了用户的心情。

1）不好的体验

`慢` `卡` `无反馈` ...

2) 几个时间的概念

> 16ms: 动画流畅性的最大帧时间

> 100ms: 用户感应时间

> 400ms: 用户反映时间

> 4000ms: 用户产生情感时间

3）优化点

> 动画循环采用requestAnimationFrame方法

> 采用canvas drawImage绘制铺开效果动画

> 干掉iOS 300ms延迟

> loading toast 提示

> 进度条反馈 

> 将耗时较长的运算拆分为多个耗时较短的子计算

> 采用worker剥离计算

> ...










**参考文献**

- [如何让博客速度快到哭](https://ppt.baomitu.com/d/a8a49a00#/)
